package com.framework.config;

import java.io.File;
import java.io.FileInputStream;
import java.util.Properties;

/**
 * Simple config reader. Call ConfigManager.load("src/test/resources/application.properties") once before use.
 */
public class ConfigManager {
    private static final Properties props = new Properties();

    public static void load(String path) throws Exception {
        try (FileInputStream fis = new FileInputStream(path)) {
            props.load(fis);
        }
    }

    public static String get(String key) {
        return props.getProperty(key);
    }

    /**
     * If encryption.key property points to a file path, read its content,
     * otherwise treat the property value as the key itself.
     */
    public static String getEncryptionKey() throws Exception {
        String raw = props.getProperty("encryption.key");
        if (raw == null) {
            throw new IllegalStateException("encryption.key not set in properties");
        }
        File f = new File(raw);
        if (f.exists()) {
            // read file content (small key file)
            try (FileInputStream fis = new FileInputStream(f)) {
                byte[] b = new byte[(int) f.length()];
                fis.read(b);
                return new String(b).trim();
            }
        } else {
            return raw.trim();
        }
    }
}
