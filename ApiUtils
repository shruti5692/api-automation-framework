package com.framework.utils;

import java.util.Map;

public class ApiUtils {

    public static void runApiTest(Map<String, String> row) throws Exception {
        String testCaseId = row.getOrDefault("TestCaseID", "").trim();
        String endpoint   = row.getOrDefault("Endpoint", "").trim();
        String prodId     = row.getOrDefault("PROD_ID", "").trim();
        String expStatus  = row.getOrDefault("ExpectedStatus", "200").trim();

        Map<String, String> headers = HeaderUtils.buildHeaders(prodId);

        long start = System.currentTimeMillis();
        ApiResponse response = ApiClient.get(endpoint, headers);
        long durationSec = (System.currentTimeMillis() - start) / 1000;

        if (String.valueOf(response.getStatusCode()).equals(expStatus)) {
            System.out.println("✅ " + testCaseId + " passed — " + response.getStatusCode());
            ExcelUtils.writeResultWithDuration("src/test/resources/testdata/PY22.xlsx", "PY22", testCaseId, "PASS", durationSec);
        } else {
            System.out.println("❌ " + testCaseId + " failed — Expected: " + expStatus + ", Actual: " + response.getStatusCode());
            ExcelUtils.writeResultWithDuration("src/test/resources/testdata/PY22.xlsx", "PY22", testCaseId, "FAIL", durationSec);
        }
    }
}
