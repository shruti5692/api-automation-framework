package tests;

import org.framework.utils.DBUtils;
import java.util.*;

/**
 * Builds and runs the CUD_PROD_RELN query and returns
 * Set of PROD_ID (concatenated sortCode + accountNumber)
 */
public class DbFetchHelper {

    private static final String QUERY =
        "SELECT CUST_NO, RTRIM(PROD_ID) AS PROD_ID, PROD_COD " +
        "FROM CUD_PROD_RELN " +
        "WHERE CUST_NO = ? " +
        "  AND LENGTH(RTRIM(PROD_ID)) = 14 " +
        "  AND OPEN_CLO_STA = 'O'";

    public static Set<String> fetchProdIds(String customerNumber) throws Exception {
        List<Map<String,Object>> rows = DBUtils.executeQuery(QUERY, customerNumber);
        Set<String> out = new HashSet<>();
        for (Map<String,Object> r : rows) {
            out.add(String.valueOf(r.get("PROD_ID")).trim());
        }
        return out;
    }
}
