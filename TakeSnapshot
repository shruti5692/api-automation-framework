' RunMacroAndSnapshot.vbs
Dim autECLPSObj
Set autECLPSObj = CreateObject("PCOMM.autECLPS")

' Your session name (from PCOMM session list)
Dim sessionName
sessionName = "A"

' Check if session exists
Dim sessionExists
sessionExists = False

Dim i
For i = 1 To autECLPSObj.SessionCount
    If autECLPSObj.GetSessionName(i) = sessionName Then
        sessionExists = True
        Exit For
    End If
Next

' If session does not exist, open it automatically
If Not sessionExists Then
    WScript.Echo "Session '" & sessionName & "' not found. Opening session..."
    ' Provide full path to the .ws or session file
    Dim sessionFile
    sessionFile = "C:\Program Files (x86)\IBM\Personal Communications\Sessions\A.ws"  
    autECLPSObj.StartSession sessionFile
    ' Give it a few seconds to fully load
    WScript.Sleep 5000
End If

' Attach to the session
autECLPSObj.SetConnectionByName sessionName

' Arguments from Java
Dim macroPath, snapshotPath
macroPath = WScript.Arguments.Item(0)
snapshotPath = WScript.Arguments.Item(1)

' Step 1: Run Macro
autECLPSObj.RunMacro macroPath

' Step 2: Take Screenshot
autECLPSObj.PrintScreenToFile snapshotPath

WScript.Echo "Macro executed and snapshot saved successfully."
